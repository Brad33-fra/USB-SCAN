import platform
import psutil
import webbrowser
from datetime import datetime
import subprocess

# ===== DEMANDER LES INFOS Ã€ L'UTILISATEUR =====
nom = input("Votre nom : ")
prenom = input("Votre prÃ©nom : ")
poste = input("NumÃ©ro du poste : ")

# ===== RÃ‰CUPÃ‰RER LA DATE ET L'HEURE =====
maintenant = datetime.now()
date_audit = maintenant.strftime("%d/%m/%Y")
heure_audit = maintenant.strftime("%H:%M")

# ===== RÃ‰CUPÃ‰RER LES INFOS DU PC =====
# SystÃ¨me d'exploitation
systeme = platform.system() + " " + platform.release()

# Processeur
processeur = platform.processor()

# Nombre de ports USB (selon le systÃ¨me)
ports_usb = 0

if platform.system() == "Windows":
    # Sous Windows, on utilise wmic pour lister les contrÃ´leurs USB
    try:
        result = subprocess.run(['wmic', 'path', 'Win32_USBControllerDevice', 'get', 'Dependent'], capture_output=True, text=True)
        ports_usb = result.stdout.count('USB')
    except:
        ports_usb = "Non dÃ©tectÃ© (exÃ©cution en admin requise ?)"
elif platform.system() == "Linux":
    # Sous Linux, on compte les ports dans /sys/bus/usb/devices/
    try:
        result = subprocess.run(['ls', '/sys/bus/usb/devices/'], capture_output=True, text=True)
        ports_usb = len([line for line in result.stdout.splitlines() if 'usb' in line.lower() and line[0].isdigit()])
    except:
        ports_usb = "Non dÃ©tectÃ© (droits insuffisants ?)"
else:
    ports_usb = "Non supportÃ© sur ce systÃ¨me"

# ===== CRÃ‰ER LA PAGE HTML =====
html = f"""
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Rapport d'Audit PC</title>
    <style>
        body {{ font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; background: #f0f0f0; padding: 20px; }}
        .rapport {{ background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.1); }}
        h1 {{ color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; }}
        .info {{ margin: 15px 0; padding: 10px; background: #ecf0f1; border-left: 4px solid #3498db; }}
        .label {{ font-weight: bold; color: #2c3e50; }}
    </style>
</head>
<body>
    <div class="rapport">
        <h1>ğŸ“‹ RAPPORT D'AUDIT PC</h1>
        <div class="info"><span class="label">ğŸ‘¤ Nom :</span> {nom}</div>
        <div class="info"><span class="label">ğŸ‘¤ PrÃ©nom :</span> {prenom}</div>
        <div class="info"><span class="label">ğŸ’» Poste :</span> {poste}</div>
        <div class="info"><span class="label">ğŸ“… Date :</span> {date_audit}</div>
        <div class="info"><span class="label">ğŸ• Heure :</span> {heure_audit}</div>

        <h2>ğŸ–¥ï¸ INFORMATIONS TECHNIQUES</h2>
        <div class="info"><span class="label">ğŸ”Œ Ports USB :</span> {ports_usb}</div>
        <div class="info"><span class="label">ğŸ’¿ SystÃ¨me :</span> {systeme}</div>
        <div class="info"><span class="label">âš™ï¸ Processeur :</span> {processeur}</div>
    </div>
</body>
</html>
"""

# ===== SAUVEGARDER ET OUVRIR =====
with open("audit_pc.html", "w", encoding="utf-8") as fichier:
    fichier.write(html)

webbrowser.open("audit_pc.html")

print("\nâœ… Rapport crÃ©Ã© ! Le navigateur va s'ouvrir automatiquement.")
